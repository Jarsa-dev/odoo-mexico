import urllib2
user = 'aaa010101aaa'
password='PWD'
url = "http://pruebas.comercio-digital.mx/timbre/v2/timbrar.aspx?rfc={0}&pwd={1}".format(user,password)
#cfdi = '<?xml version="1.0" encoding="UTF-8"?><cfdi:Comprobante LugarExpedicion="Ciudad de Mexico Distrito Federal, Mexico" Moneda="MXN" NumCtaPago="No identificado" TipoCambio="1.0" certificado="MIIEoTCCA4mgAwIBAgIUMDAwMDEwMDAwMDAyMDIwNjI4MzcwDQYJKoZIhvcNAQEFBQAwggGVMTgwNgYDVQQDDC9BLkMuIGRlbCBTZXJ2aWNpbyBkZSBBZG1pbmlzdHJhY2nDs24gVHJpYnV0YXJpYTEvMC0GA1UECgwmU2VydmljaW8gZGUgQWRtaW5pc3RyYWNpw7NuIFRyaWJ1dGFyaWExODA2BgNVBAsML0FkbWluaXN0cmFjacOzbiBkZSBTZWd1cmlkYWQgZGUgbGEgSW5mb3JtYWNpw7NuMSEwHwYJKoZIhvcNAQkBFhJhc2lzbmV0QHNhdC5nb2IubXgxJjAkBgNVBAkMHUF2LiBIaWRhbGdvIDc3LCBDb2wuIEd1ZXJyZXJvMQ4wDAYDVQQRDAUwNjMwMDELMAkGA1UEBhMCTVgxGTAXBgNVBAgMEERpc3RyaXRvIEZlZGVyYWwxFDASBgNVBAcMC0N1YXVodMOpbW9jMRUwEwYDVQQtEwxTQVQ5NzA3MDFOTjMxPjA8BgkqhkiG9w0BCQIML1Jlc3BvbnNhYmxlOiBDZWNpbGlhIEd1aWxsZXJtaW5hIEdhcmPDrWEgR3VlcnJhMB4XDTEyMTAwMjE5MTUzNVoXDTE2MTAwMjE5MTUzNVowgeIxJjAkBgNVBAMTHUFVVE8gTElRVUkgUkVGSU5BRE9TIFNBIERFIENWMSYwJAYDVQQpEx1BVVRPIExJUVVJIFJFRklOQURPUyBTQSBERSBDVjEmMCQGA1UEChMdQVVUTyBMSVFVSSBSRUZJTkFET1MgU0EgREUgQ1YxJTAjBgNVBC0THEFMUjczMTAxMDM4NyAvIERVSEM1MzExMjNRSDAxHjAcBgNVBAUTFSAvIERVSEM1MzExMjNNREZSUkMwMzEhMB8GA1UECxMYQURNSU5JU1RSQUNJT04gREVMIE5PUlRFMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC5iVQ23Loa5oRgo8SOo0Xk6DQk/jlQ93Pn1FMf5ZJnranZR5miCAmC8oegdZYt9dlRuKVm9spnvb6k1bjBRx9uQt3mBFlguJ7VPD3AyqkOkXM94oJ732Ye15xbApyOWmVzBMrOIas7layVQJ5Kn5POhzXG4oUtVqhV6By3V8AOiwIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEAlznhUezxXi41PzopB/jIb2P1BJT9nC1lcTfRSmkKkxNxe2stbuOK9p0hcVZ/FTL6lZ+A+TE3HyW4lNkqLMw6g+fHMIXO3eOZE2OzeNLsyBCyOTW+asfhyjEIe7tgjpMFBA/bRkb4/KoqOtoidY0LN5I6XdnP8qTf3aK/9PbpmS9S08BX3X159djRtp1UFiFtis+gn8ucc3NG+RvWDTNl7QohwTfZ25dqpRJp5iEks/qJ1BCf6a8e4Dut9Nf+sGozYzdcKo+6cEZI9tZif4+tyGI8nYGFCUSrntAGNykLVsfPg+PX297oATD8rTo/5iNvMwHdHU4G7cN3DjUx0TzcCQ==" descuento="0" fecha="2014-01-15T17:20:02" folio="0025" formaDePago="Pago en una sola exhibicion" metodoDePago="No Identificado"           noCertificado="00001000000202062837" sello="WgaIYbEPparrDg76oF2kWfsigRgx0Wdi7NxJ27ArLqLn3beMqeDEZNsS6EszBEe3luIf4TgukTXkYqCyn2swn0ldhdiV3pNBPLLr/+CjdVuD5fYUwilNcQBpZpPwxsHVqb9uUBsiTYU6/Uviu8NhAeB43l/PerGSbjTISLEWtBs="           subTotal="15784.00" tipoDeComprobante="ingreso" total="17795.11" version="3.2" xmlns:cfdi="http://www.sat.gob.mx/cfd/3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd"><cfdi:Emisor nombre="AUTO LIQUI REFINADOS S.A. DE C.V." rfc="ALR731010387"><cfdi:DomicilioFiscal calle="Laminadores #215" codigoPostal="02650" colonia="Col. Trabajadores del Hierro" estado="Distrito Federal" localidad="Del. Azcapotzalco" municipio="Ciudad de Mexico" noExterior="215" noInterior="N/A" pais="Mexico"/><cfdi:ExpedidoEn calle="Laminadores #215" codigoPostal="02650" colonia="Col. Trabajadores del Hierro" estado="Distrito Federal" localidad="Del. Azcapotzalco" municipio="Ciudad de Mexico" noExterior="215" noInterior="N/A" pais="Mexico"/><cfdi:RegimenFiscal Regimen="Personas morales del regimen simplificado"/></cfdi:Emisor><cfdi:Receptor nombre="PEMEX REFINACION" rfc="PRE9207163T7"><cfdi:Domicilio calle="Av. Marina Nacional" codigoPostal="11311" colonia="Col. Petroleos Mexicanos" estado="Distrito Federal" localidad="Deleg. Miguel Hidalgo" municipio="Ciudad de Mexico" noExterior="Num 329" noInterior="N/A" pais="Mexico"/></cfdi:Receptor><cfdi:Conceptos><cfdi:Concepto cantidad="1.00" descripcion="FLETE 36658 DE FECHA 06/01/2014" importe="12858.14" unidad="SER" valorUnitario="12858.14"/><cfdi:Concepto cantidad="1.00" descripcion="PEAJE" importe="2925.86" unidad="SER" valorUnitario="2925.86"/></cfdi:Conceptos><cfdi:Impuestos totalImpuestosRetenidos="514.33" totalImpuestosTrasladados="2525.44"><cfdi:Retenciones><cfdi:Retencion importe="514.33" impuesto="IVA"/></cfdi:Retenciones><cfdi:Traslados><cfdi:Traslado importe="2525.44" impuesto="IVA" tasa="16.00"/><cfdi:Traslado importe="0.00" impuesto="IEPS" tasa="0.00"/></cfdi:Traslados></cfdi:Impuestos></cfdi:Comprobante>'
cfdi = '<?xml version="1.0" encoding="UTF-8"?><cfdi:Comprobante LugarExpedicion="Ixtaczoquitlan Veracruz, Mexico" Moneda="MXN" NumCtaPago="3123" TipoCambio="1.0" certificado="MIIEdDCCA1ygAwIBAgIUMDAwMDEwMDAwMDAyMDI1OTk3ODUwDQYJKoZIhvcNAQEFBQAwggGVMTgwNgYDVQQDDC9BLkMuIGRlbCBTZXJ2aWNpbyBkZSBBZG1pbmlzdHJhY2nDs24gVHJpYnV0YXJpYTEvMC0GA1UECgwmU2VydmljaW8gZGUgQWRtaW5pc3RyYWNpw7NuIFRyaWJ1dGFyaWExODA2BgNVBAsML0FkbWluaXN0cmFjacOzbiBkZSBTZWd1cmlkYWQgZGUgbGEgSW5mb3JtYWNpw7NuMSEwHwYJKoZIhvcNAQkBFhJhc2lzbmV0QHNhdC5nb2IubXgxJjAkBgNVBAkMHUF2LiBIaWRhbGdvIDc3LCBDb2wuIEd1ZXJyZXJvMQ4wDAYDVQQRDAUwNjMwMDELMAkGA1UEBhMCTVgxGTAXBgNVBAgMEERpc3RyaXRvIEZlZGVyYWwxFDASBgNVBAcMC0N1YXVodMOpbW9jMRUwEwYDVQQtEwxTQVQ5NzA3MDFOTjMxPjA8BgkqhkiG9w0BCQIML1Jlc3BvbnNhYmxlOiBDZWNpbGlhIEd1aWxsZXJtaW5hIEdhcmPDrWEgR3VlcnJhMB4XDTEyMTIxMzE4NTg0NFoXDTE2MTIxMzE4NTg0NFowgbUxHTAbBgNVBAMTFEZMRVRFUyBIRVNBIFNBIERFIENWMR0wGwYDVQQpExRGTEVURVMgSEVTQSBTQSBERSBDVjEdMBsGA1UEChMURkxFVEVTIEhFU0EgU0EgREUgQ1YxJTAjBgNVBC0THEZIRTc1MDEwNFU3MSAvIENBVEU1NTA0MTlQTjMxHjAcBgNVBAUTFSAvIENBVEU1NTA0MTlIVlpIUkQwMjEPMA0GA1UECxMGTUFUUklaMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDMiLa+zstZpst/Re7Flb+1b0Lpa732apf3pZaE/IxCQXmGSbc9QGaoTJ7mtn9GakEMPV0NBFbeyzaUJ08p/2yyxrKjXU8Yg5ZDwCMSdNpWTPExQz2MOyqNYMSX/UWDxWC9ecuIVEf5kzIPGl0U4lFlHcM4sLB2uK203EZqZAxjkwIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEAbIt/C8IWYwHlnAkt93KMEfWl+Vhc5GuFYbX1X+juDCAhkGxzAvLGbBShEVkhkxXnBgUNtMQ9oO3b4a+Dr2wmntHxM5YTADPQsiwx0X021zk0DQzIEiVRTKKRATojVt+v0/U3WcU5j1uZkoJ58i45FIljqZTGQi6r2fi0Okwjt2UNoz/6babPHIm5gJm4cxHgHFBmbfWhB0B1Wg185e84re3cH5S8DN8Enwrz0jiQT2GD/KCJYktPz+TJrHyhZUssXJg/NkZyNkC0AVpBBGBlvAauGOe46s26ixiuLV8d5qaQ5sblL5LQjylVI4bQql3Eoy/cJULt4Ph3fBiNVXrQ5g==" descuento="0" fecha="2014-01-18T10:18:24" folio="4" formaDePago="Pago en una sola exhibicion" metodoDePago="Transferencia Electronica" noCertificado="00001000000202599785" sello="TbrF7cz3NKuoL+Qo8Gq67zq0I/gxzDF4+aWBWpwemexctyDRtG/QtaN3acxRgbK5CbtKMpiPP0FioYhioizxdhtBG1UT2EtfUREzKwNrDOvR1nyhjdgjElXnJ7nxAlTrFaJmiOfR8+TaeINiXUYJuN4/shIK1JBSJEchGTRT+Kw=" serie="A" subTotal="10000.00" tipoDeComprobante="ingreso" total="11600.00" version="3.2" xmlns:cfdi="http://www.sat.gob.mx/cfd/3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd"><cfdi:Emisor nombre="FLETES HESA SA DE CV" rfc="FHE750104U71"><cfdi:DomicilioFiscal calle="Carret. Federal Mexico-Veracruz Km 321" codigoPostal="94450" colonia="Sin Colonia" estado="Veracruz" localidad="Ixtaczoquitlan" municipio="Ixtaczoquitlan" noExterior="Sin Num" noInterior="Int 2" pais="Mexico"/><cfdi:ExpedidoEn calle="Carret. Federal Mexico-Veracruz Km 321" codigoPostal="94450" colonia="Sin Colonia" estado="Veracruz" localidad="Ixtaczoquitlan" municipio="Ixtaczoquitlan" noExterior="Sin Num" noInterior="Int 2" pais="Mexico"/><cfdi:RegimenFiscal Regimen="Personas morales del regimen general"/></cfdi:Emisor><cfdi:Receptor nombre="HESA TECNICA SA DE CV" rfc="HTE031031226"><cfdi:Domicilio calle="Calle 5" codigoPostal="94300" colonia="Centro" estado="Veracruz" municipio="Orizaba" noExterior="123" noInterior="N/A" pais="Mexico"/></cfdi:Receptor><cfdi:Conceptos><cfdi:Concepto cantidad="1.00" descripcion="Servicio" importe="10000.00" unidad="Hora(s)" valorUnitario="10000.00"/></cfdi:Conceptos><cfdi:Impuestos totalImpuestosTrasladados="1600.00"><cfdi:Traslados><cfdi:Traslado importe="1600.00" impuesto="IVA" tasa="16.00"/><cfdi:Traslado importe="0.00" impuesto="IEPS" tasa="0.00"/></cfdi:Traslados></cfdi:Impuestos></cfdi:Comprobante>'


http = urllib2.build_opener(urllib2.ProxyHandler, urllib2.UnknownHandler, urllib2.HTTPHandler,urllib2.HTTPDefaultErrorHandler, urllib2.FTPHandler, urllib2.FileHandler, urllib2.HTTPErrorProcessor)
req = urllib2.Request(url=url, data=cfdi, headers={'Content-Type': 'text/xml'})
response = http.open(req)
codigo = response.code
respuesta = response.read()


PRUEBAS:
Timbrar:     http://pruebas.comercio-digital.mx/timbre/v2/timbrar.aspx
Cancelacion: http://pruebas.comercio-digital.mx/cancela/uuid.aspx


PRODUCCION
Timbrar:     http://ws.comercio-digital.mx/timbre/v2/timbrar.aspx
Cancelacion: https://ws.comercio-digital.mx/cancela/uuid.aspx